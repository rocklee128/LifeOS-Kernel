<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS - ä¸ªäººç”Ÿå­˜é€»è¾‘å®¡è®¡ç³»ç»Ÿ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root { --bg: #050505; --paper: #fdfbf7; --ink: #1a1a1a; --accent: #00f0ff; --matrix: #0f0; --danger: #ff2a6d; --gold: #FFD700; }
        body { background-color: var(--bg); color: #e4e4e7; font-family: 'Noto Sans SC', sans-serif; -webkit-font-smoothing: antialiased; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .serif { font-family: 'Noto Serif SC', serif; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.6s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.5s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Report Paper */
        .report-paper { background-color: var(--paper); color: var(--ink); box-shadow: 0 0 50px rgba(0,0,0,0.5); background-image: radial-gradient(#e5e5e5 1px, transparent 1px); background-size: 20px 20px; }
        .stamp { mask-image: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/8399/grunge.png'); mask-size: 944px 604px; mix-blend-mode: multiply; animation: stamp-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; transform: scale(1.5) rotate(-15deg); border-width: 6px !important; font-weight: 900 !important; }
        @keyframes stamp-in { to { opacity: 1; transform: scale(1) rotate(-12deg); } }

        /* Dashboard & Cards */
        .dash-card { background: linear-gradient(145deg, #111, #0a0a0a); border: 1px solid #222; border-radius: 1rem; position: relative; overflow: hidden; }
        .option-card { background: rgba(255,255,255,0.02); border: 1px solid #333; transition: all 0.2s; }
        .option-card:hover { border-color: #666; background: rgba(255,255,255,0.05); }
        
        /* Checkbox Style (Capsule) */
        .check-capsule {
            height: 3.5rem;
            border: 1px solid #333; border-radius: 0.75rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255,255,255,0.02);
            position: relative; overflow: hidden;
        }
        .check-capsule:hover { border-color: var(--matrix-green); background: rgba(0, 255, 0, 0.05); }
        .check-capsule.checked {
            background: rgba(0, 255, 0, 0.15); border-color: var(--matrix-green);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        .check-capsule .day-label { font-size: 0.65rem; color: #666; font-family: 'JetBrains Mono'; margin-bottom: 2px; }
        .check-capsule.checked .day-label { color: var(--matrix-green); }
        .check-capsule .icon-box { color: #333; transition: all 0.3s; transform: scale(0.8); }
        .check-capsule.checked .icon-box { color: var(--matrix-green); transform: scale(1.2); filter: drop-shadow(0 0 5px var(--matrix-green)); }

        /* Flip */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        .bg-grid { background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 40px 40px; }
        .glow-pulse { animation: glowPulse 3s infinite ease-in-out; }
        @keyframes glowPulse { 0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); } 50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); } 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); } }
        
        .modal-overlay { background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); }
        .social-btn { transition: all 0.2s; }
        .social-btn:hover { transform: translateY(-2px); border-color: var(--gold); color: var(--gold); }

        /* Input Styling */
        .cyber-input { background: rgba(0,0,0,0.5); border: 1px solid #333; color: #fff; font-family: 'Noto Sans SC', sans-serif; transition: all 0.3s; }
        .cyber-input:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); outline: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // 1. SYSTEM DATABASE
        // ==========================================

        const QUESTIONS = [
            { id: "q1_runway", module: "M1 â€¢ è´¢å¯Œåº•ç›˜", label: "è´¢åŠ¡å¥åº· / ç”Ÿå­˜åº•æ°”", question: "å¦‚æœæ˜å¤©åœæ­¢å·¥ä½œï¼Œä½ çš„å­˜æ¬¾èƒ½ç»´æŒå¤šä¹…ï¼Ÿ", options: [{val:"A",text:"< 1ä¸ªæœˆ (å´©æºƒ)",s:0}, {val:"B",text:"1-6ä¸ªæœˆ (ç„¦è™‘)",s:30}, {val:"C",text:"6-18ä¸ªæœˆ (è°ƒæ•´æœŸ)",s:60}, {val:"D",text:"> 18ä¸ªæœˆ (æ— å¿§)",s:100}] },
            { id: "q2_passive", module: "M1 â€¢ è´¢å¯Œåº•ç›˜", label: "è´¢åŠ¡å¥åº· / æ”¶å…¥æˆåˆ†", question: "ä½ çš„â€œç¡åæ”¶å…¥â€å æ¯”å¤šå°‘ï¼Ÿ", options: [{val:"A",text:"0% (çº¯å–æ—¶é—´)",s:0}, {val:"B",text:"< 10% (ç†è´¢)",s:20}, {val:"C",text:"30-50% (å‰¯ä¸š)",s:70}, {val:"D",text:"> 50% (èµ„äº§)",s:100}] },
            { id: "q3_growth", module: "M1 â€¢ è´¢å¯Œåº•ç›˜", label: "è´¢åŠ¡å¥åº· / å¢é•¿è·‘é“", question: "å›é¡¾è¿‡å» 3 å¹´ï¼Œä½ çš„å‡€èµ„äº§å¢é•¿é€Ÿåº¦ï¼Ÿ", options: [{val:"A",text:"å€’é€€",s:0}, {val:"B",text:"é¾Ÿé€Ÿ (è·‘è¾“é€šèƒ€)",s:30}, {val:"C",text:"çº¿æ€§ (é åŠ è–ª)",s:60}, {val:"D",text:"æŒ‡æ•° (çˆ†å‘)",s:100}] },
            
            { id: "q4_control", module: "M2 â€¢ æ—¶é—´ä¸»æƒ", label: "æ—¶é—´è‡ªä¸» / é¢—ç²’åº¦", question: "è°åœ¨å†³å®šä½ æ¯å¤©æ€ä¹ˆè¿‡ï¼Ÿ", options: [{val:"A",text:"ä»–äººä¸»å¯¼",s:10}, {val:"B",text:"è¢«åŠ¨é”¯é½¿çŠ¶",s:40}, {val:"C",text:"æ¨¡å—åŒ–æŒæ§",s:70}, {val:"D",text:"å®Œå…¨è‡ªä¸»",s:100}] },
            { id: "q5_role", module: "M2 â€¢ æ—¶é—´ä¸»æƒ", label: "æ—¶é—´è‡ªä¸» / ä¸šåŠ¡è§’è‰²", question: "ä½ åœ¨èµšé’±ç³»ç»Ÿä¸­æ‰®æ¼”ä»€ä¹ˆï¼Ÿ", options: [{val:"A",text:"ç”µæ±  (è€—æ)",s:10}, {val:"B",text:"æ ¸å¿ƒé›¶ä»¶",s:50}, {val:"C",text:"é©¾é©¶å‘˜",s:80}, {val:"D",text:"è®¾è®¡å¸ˆ",s:100}] },
            { id: "q6_rnd", module: "M2 â€¢ æ—¶é—´ä¸»æƒ", label: "æ—¶é—´è‡ªä¸» / ç ”å‘æŠ•å…¥", question: "ä¸Šå‘¨èŠ±äº†å¤šå°‘æ—¶é—´æŠ•èµ„æœªæ¥ï¼Ÿ", options: [{val:"A",text:"0å°æ—¶",s:0}, {val:"B",text:"< 2å°æ—¶",s:30}, {val:"C",text:"5-10å°æ—¶",s:70}, {val:"D",text:"> 10å°æ—¶",s:100}] },
            
            { id: "q7_keyman", module: "M3 â€¢ åè„†å¼±ç³»ç»Ÿ", label: "é£é™©æŠ¤åŸæ²³ / å…³é”®äººé£é™©", question: "å¦‚æœä½ ä½é™¢ä¸€ä¸ªæœˆï¼Œä¸šåŠ¡ä¼šæ€æ ·ï¼Ÿ", options: [{val:"A",text:"å½»åº•ç˜«ç—ª",s:0}, {val:"B",text:"é™·å…¥æ··ä¹±",s:30}, {val:"C",text:"çŸ­æš‚æ³¢åŠ¨",s:70}, {val:"D",text:"è‡ªåŠ¨å¢é•¿",s:100}] },
            { id: "q8_replace", module: "M3 â€¢ åè„†å¼±ç³»ç»Ÿ", label: "é£é™©æŠ¤åŸæ²³ / è¢«æ›¿ä»£éš¾åº¦", question: "æ‰¾äººæˆ–AIæ›¿ä»£ä½ çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œéš¾åº¦å¤šå¤§ï¼Ÿ", options: [{val:"A",text:"ææ˜“",s:0}, {val:"B",text:"ä¸­ç­‰",s:30}, {val:"C",text:"å›°éš¾",s:70}, {val:"D",text:"æéš¾",s:100}] },
            { id: "q9_dep", module: "M3 â€¢ åè„†å¼±ç³»ç»Ÿ", label: "é£é™©æŠ¤åŸæ²³ / å®¢æˆ·é›†ä¸­åº¦", question: "æ”¶å…¥æ¥æºæ˜¯å¦å•ä¸€ï¼Ÿ", options: [{val:"A",text:"å•ç‚¹ä¾èµ–",s:0}, {val:"B",text:"åŒè½¨åˆ¶",s:50}, {val:"C",text:"å¤šç‚¹æ”¯æ’‘",s:80}, {val:"D",text:"ç”Ÿæ€åŒ–",s:100}] },
            
            { id: "q10_burnout", module: "M4 â€¢ èƒ½é‡ç†µå¢", label: "ç³»ç»ŸæŸè€— / èº«å¿ƒç£¨æŸ", question: "ç°åœ¨çš„èº«å¿ƒçŠ¶æ€ï¼Ÿ", options: [{val:"A",text:"çº¢è‰²è­¦æŠ¥",s:0}, {val:"B",text:"äºšå¥åº·",s:30}, {val:"C",text:"å¹³ç¨³",s:70}, {val:"D",text:"å……ç›ˆ",s:100}] },
            { id: "q11_network", module: "M4 â€¢ èƒ½é‡ç†µå¢", label: "ç³»ç»ŸæŸè€— / ç¤¾äº¤æ»‹å…»", question: "æœ€å¸¸æ¥è§¦çš„5ä¸ªäººçŠ¶æ€ï¼Ÿ", options: [{val:"A",text:"èƒ½é‡é»‘æ´",s:0}, {val:"B",text:"å¹³åº¸æ¸©å’Œ",s:30}, {val:"C",text:"äº’åˆ©å…±ç”Ÿ",s:70}, {val:"D",text:"é«˜ç»´å¼•é¢†",s:100}] },
            { id: "q12_meaning", module: "M4 â€¢ èƒ½é‡ç†µå¢", label: "ç³»ç»ŸæŸè€— / æ„¿æ™¯å¯¹é½", question: "å¦‚æœç»™ä¸€åƒä¸‡è®©ä½ æ°¸è¿œåœæ­¢ç°åœ¨åšçš„äº‹ï¼Ÿ", options: [{val:"A",text:"ç‹‚å–œ",s:0}, {val:"B",text:"çŠ¹è±«",s:30}, {val:"C",text:"ä¼šæ‹¿(å·å·åš)",s:70}, {val:"D",text:"æ‹’ç»",s:100}] }
        ];

        const PERSONA_DB = {
            "SURVIVAL_MODE": { label: "ç”Ÿå­˜å±æœºå‹", verdict: "ä½ çš„å•†ä¸šæ¨¡å¼å·²å‡»ç©¿ç›ˆäºå¹³è¡¡ç‚¹ã€‚", desc: "ç°é‡‘æµæåº¦è„†å¼±ã€‚é¦–è¦ä»»åŠ¡æ˜¯æ­¢è¡€å’Œå¿«é€Ÿå˜ç°ã€‚", priority: "æ­¢è¡€ & ç°é‡‘æµ" },
            "GOLDEN_HANDCUFFS": { label: "é‡‘æ‰‹é“ç»¼åˆç—‡", verdict: "ä½ æ‹¥æœ‰é«˜æº¢ä»·ï¼Œä½†æœ¬è´¨æ˜¯â€œé«˜çº§è€—æâ€ã€‚", desc: "æœ‰é’±æ²¡æ—¶é—´ã€‚ç”Ÿæ´»æ–¹å¼é”æ­»äº†æ”¶å…¥ç»“æ„ã€‚ä½ åœ¨æ¶ˆè€—ç”Ÿå‘½æ¢å–è´§å¸ã€‚", priority: "èµå›æ—¶é—´ & é™çº§" },
            "FOUNDERS_TRAP": { label: "åˆ›å§‹äººé™·é˜±", verdict: "ä½ æ‹¥æœ‰çš„ä¸æ˜¯ä¼ä¸šï¼Œæ˜¯ä¸€ä»½å…¨å¹´æ— ä¼‘çš„å·¥ä½œã€‚", desc: "å…¬å¸ç¦»ä¸å¼€ä½ ï¼Œæ— æ³•è§„æ¨¡åŒ–ã€‚ä½ æ˜¯ç³»ç»Ÿæœ€å¤§çš„ç“¶é¢ˆã€‚", priority: "å»è‡ªæˆ‘åŒ– & æˆæƒ" },
            "UNDERVALUED": { label: "èµ„äº§é”™é…å‹", verdict: "ä½ ååœ¨é‡‘çŸ¿ä¸Šä¹è®¨ã€‚", desc: "æœ‰èƒ½åŠ›ï¼ˆé«˜èµ„äº§ï¼‰ï¼Œä¸æ‡‚å˜ç°ï¼ˆä½æ æ†ï¼‰ã€‚ä½ éœ€è¦é”€å”®æ€ç»´ã€‚", priority: "æš´åŠ›è¾“å‡º & é”€å”®" },
            "FRAGILE_MIDDLE": { label: "è„†å¼±ä¸­äº§å‹", verdict: "è¡¨é¢å…‰é²œï¼Œå®åˆ™å¦‚å±¥è–„å†°ã€‚", desc: "å•ç‚¹ä¾èµ–æ˜¯æœ€å¤§é£é™©ã€‚ä»»ä½•é»‘å¤©é¹…éƒ½èƒ½å‡»ç©¿é˜²çº¿ã€‚", priority: "ç³»ç»Ÿå¤‡ä»½ & å‰¯ä¸š" },
            "STAGNANT": { label: "å¹³åº¸ç¨³å¥å‹", verdict: "ä½ åœ¨æ¸©æ°´ä¸­ï¼Œè¿˜æ²¡æ„è¯†åˆ°æ°´æ¸©åœ¨å‡é«˜ã€‚", desc: "å®‰å…¨åŒºå°±æ˜¯å¹³åº¸åŒºã€‚ä¸å¯»æ‰¾ä¸å¯¹ç§°æœºä¼šï¼Œå°†è¢«æ…¢é€Ÿæ·˜æ±°ã€‚", priority: "æ‰“ç ´æƒ¯æ€§ & æ¢ç´¢" },
            "FREEDOM_LEADER": { label: "è‡ªç”±é¢†èˆªè€…", verdict: "ä½ å·²è·ƒè¿è‡³â€œè®¾è®¡ç”Ÿæ´»â€çš„ç»´åº¦ã€‚", desc: "ç³»ç»Ÿå¥å£®ã€‚ç°åœ¨çš„æ•Œäººæ˜¯æ— èŠã€‚å¯»æ‰¾æ–°ä½¿å‘½ã€‚", priority: "ç²¾ç¥ä¼ æ‰¿ & å½±å“åŠ›" }
        };

        // --- ALGORITHMS ---
        const calculatePersona = (answers) => {
            const getVal = (id) => answers[id]?.val || 'A';
            if (['D'].includes(getVal('q1_runway')) && ['D'].includes(getVal('q4_control'))) return "FREEDOM_LEADER";
            if (getVal('q1_runway') === 'A') return "SURVIVAL_MODE";
            if (['C','D'].includes(getVal('q1_runway')) && ['A','B'].includes(getVal('q4_control'))) return "GOLDEN_HANDCUFFS";
            if (['B','C'].includes(getVal('q5_role')) && ['A','B'].includes(getVal('q7_keyman')) && ['C','D'].includes(getVal('q1_runway'))) return "FOUNDERS_TRAP";
            if (['C','D'].includes(getVal('q6_rnd')) && ['C','D'].includes(getVal('q8_replace'))) return "UNDERVALUED";
            if (getVal('q9_dep') === 'A') return "FRAGILE_MIDDLE";
            return "STAGNANT";
        };

        const calculateScores = (answers) => {
            const getS = (id) => answers[id]?.s || 0;
            return {
                financial: Math.round((getS('q1_runway') + getS('q2_passive') + getS('q3_growth')) / 3),
                time: Math.round((getS('q4_control') + getS('q5_role') + getS('q6_rnd')) / 3),
                risk: Math.round((getS('q7_keyman') + getS('q8_replace') + getS('q9_dep')) / 3),
                energy: Math.round((getS('q10_burnout') + getS('q11_network') + getS('q12_meaning')) / 3)
            };
        };

        const getFuzzyStatus = (scores) => {
            let defenseLevel = "ğŸ›¡ï¸ Dçº§ (è„†å¼±)", defenseColor = "text-[var(--danger)]";
            if (scores.financial > 30) { defenseLevel = "ğŸ›¡ï¸ Cçº§ (æ™®é€š)"; defenseColor = "text-yellow-500"; }
            if (scores.financial > 60) { defenseLevel = "ğŸ›¡ï¸ Bçº§ (åšå›º)"; defenseColor = "text-blue-400"; }
            if (scores.financial > 90) { defenseLevel = "ğŸ›¡ï¸ Sçº§ (å ¡å’)"; defenseColor = "text-[var(--matrix-green)]"; }

            const avgScore = (scores.financial + scores.time + scores.risk + scores.energy) / 4;
            let sysVersion = "åˆå§‹ç”Ÿå­˜ç‰ˆ", sysColor = "text-zinc-500";
            if (avgScore > 40) { sysVersion = "ç¨³å¥å¢é•¿ç‰ˆ"; sysColor = "text-white"; }
            if (avgScore > 60) { sysVersion = "é«˜æ•ˆæ‰©å¼ ç‰ˆ"; sysColor = "text-[var(--gold)]"; }
            if (avgScore > 80) { sysVersion = "è‡ªç”±é¢†èˆªç‰ˆ"; sysColor = "text-[var(--accent)]"; }

            return { defenseLevel, defenseColor, sysVersion, sysColor };
        };

        // ==========================================
        // 2. VIEW COMPONENTS
        // ==========================================

        const IntroView = ({ onStart }) => (
            <div className="h-screen flex flex-col items-center justify-center p-6 text-center fade-in bg-grid relative">
                <div className="max-w-2xl mx-auto z-10">
                    <h1 className="text-5xl md:text-6xl font-bold mb-8 text-white tracking-tighter">LifeOS<br/><span className="text-[var(--accent)]">ç”Ÿå­˜é€»è¾‘å®¡è®¡</span></h1>
                    <p className="text-zinc-400 mb-12 text-sm md:text-base leading-relaxed max-w-lg mx-auto">ä¸ä»…æ˜¯ä½“æ£€ï¼Œæ›´æ˜¯ä¸€æ¬¡ç²¾å‡†çš„æ‰‹æœ¯ã€‚<br/>é€šè¿‡ 4 é˜¶æ®µç³»ç»Ÿï¼Œä¸ºä½ ç”Ÿæˆå®šåˆ¶åŒ–ç”Ÿå­˜æ–¹æ¡ˆã€‚</p>
                    <button onClick={onStart} className="px-10 py-4 bg-white text-black font-bold font-mono text-sm hover:bg-[var(--accent)] transition-all rounded shadow-lg">[ å¯åŠ¨å®¡è®¡ ]</button>
                </div>
            </div>
        );

        const AuditView = ({ qIndex, onAnswer, onBack }) => {
            const data = QUESTIONS[qIndex];
            const progress = ((qIndex + 1) / QUESTIONS.length) * 100;
            return (
                <div className="min-h-screen flex flex-col bg-grid fade-in" key={qIndex}>
                    <div className="fixed top-0 left-0 w-full h-16 bg-black/90 backdrop-blur border-b border-zinc-800 z-50 flex items-center justify-between px-6">
                        <div className="flex items-center gap-4">
                            {qIndex > 0 && <button onClick={onBack} className="text-zinc-400 hover:text-white flex items-center gap-1 font-mono text-xs"><i data-lucide="arrow-left" width="14"></i> BACK</button>}
                        </div>
                        <span className="font-mono text-xs text-[var(--accent)]">{data.module}</span>
                        <span className="font-mono text-sm font-bold text-white">{qIndex + 1} <span className="text-zinc-600">/ {QUESTIONS.length}</span></span>
                    </div>
                    <div className="fixed top-16 left-0 w-full h-1 bg-zinc-900 z-50"><div className="h-full bg-[var(--accent)] transition-all duration-300" style={{width: `${progress}%`}}></div></div>
                    <div className="flex-1 flex flex-col justify-center max-w-2xl mx-auto px-6 pt-24 pb-12 w-full">
                        <div className="mb-2 text-[var(--accent)] font-mono text-xs uppercase opacity-80">{data.label.split('/')[0]}</div>
                        <h2 className="text-2xl font-bold text-white mb-6">{data.label.split('/')[1]}</h2>
                        <p className="text-zinc-300 text-lg mb-8 border-l-2 border-[var(--accent)] pl-6 py-2 bg-white/5 rounded-r">{data.question}</p>
                        <div className="space-y-3">
                            {data.options.map((opt, idx) => (
                                <div key={idx} onClick={() => onAnswer(opt)} className="option-card p-4 rounded-lg cursor-pointer flex items-center justify-between group">
                                    <div className="flex items-center gap-4"><span className="w-6 h-6 rounded-full border border-zinc-600 flex items-center justify-center text-[10px] text-zinc-500 group-hover:border-[var(--accent)] group-hover:text-[var(--accent)]">{opt.val}</span><span className="text-zinc-300 group-hover:text-white">{opt.text}</span></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const ProcessingView = ({ onComplete }) => {
            const [log, setLog] = useState("> CONNECTING...");
            useEffect(() => {
                const logs = ["> AUDITING FINANCIAL ASSETS...", "> DETECTING KEY RISKS...", "> CALCULATING BURNOUT...", "> GENERATING STRATEGY..."];
                let i = 0;
                const interval = setInterval(() => { if (i < logs.length) setLog(logs[i++]); }, 600);
                setTimeout(onComplete, 3000);
                return () => clearInterval(interval);
            }, []);
            return (
                <div className="h-screen flex flex-col items-center justify-center bg-black font-mono">
                    <div className="w-16 h-16 border-2 border-zinc-800 border-t-[var(--accent)] rounded-full animate-spin mb-8 shadow-[0_0_30px_rgba(0,240,255,0.2)]"></div>
                    <div className="text-[var(--accent)] text-sm mb-2 animate-pulse">{log}</div>
                </div>
            );
        };

        const ReportView = ({ answers, onNext, onRetry }) => {
            const personaKey = calculatePersona(answers);
            const content = PERSONA_DB[personaKey];
            const [showStamp, setShowStamp] = useState(false);
            useEffect(() => { setTimeout(() => setShowStamp(true), 800); }, []);
            const parseText = (text) => text.split(/(\*\*.*?\*\*)/g).map((part, i) => part.startsWith('**') && part.endsWith('**') ? <span key={i} className="font-bold bg-[var(--gold)]/20 px-1">{part.slice(2, -2)}</span> : part);

            return (
                <div className="min-h-screen bg-grid py-12 px-4 flex justify-center fade-in">
                    <div className="w-full max-w-3xl report-paper p-8 md:p-12 relative">
                        {showStamp && <div className="absolute top-8 right-8 stamp border-4 border-[var(--danger)] text-[var(--danger)] px-4 py-2 font-black text-xl rounded z-10">{content.stamp}</div>}
                        <div className="border-b-2 border-black pb-6 mb-8 flex justify-between items-end">
                            <div><div className="text-3xl font-black serif text-black">è¯Šæ–­æŠ¥å‘Š</div><div className="text-xs font-mono text-zinc-500 mt-1">Life Due Diligence Report</div></div>
                            <button onClick={onRetry} className="text-xs font-bold font-mono text-zinc-500 hover:text-black hover:underline cursor-pointer">ä¿®æ­£æ•°æ® / REVISE</button>
                        </div>
                        <div className="mb-10 border-l-4 border-black pl-6 py-2"><h2 className="text-xl font-bold italic serif">"{content.verdict}"</h2></div>
                        <div className="serif text-lg text-zinc-800 leading-relaxed mb-8">{parseText(content.desc)}</div>
                        <div className="bg-zinc-100 p-6 rounded border-l-4 border-zinc-400 italic text-zinc-700 serif mb-10">å»ºè®®æ–¹å‘: {content.priority}</div>
                        <button onClick={onNext} className="w-full bg-black text-white font-mono text-sm py-4 hover:bg-zinc-800 transition-colors flex items-center justify-center gap-2 shadow-lg">
                            <span className="animate-pulse">âœ¨</span> ç”Ÿæˆè¡ŒåŠ¨è“å›¾ (Generate Blueprint) <span>â†’</span>
                        </button>
                    </div>
                </div>
            );
        };

        // --- MVP VIEW: SELF-COMMITMENT + TRANSITION ---
        const MVPView = ({ answers, onCommit }) => {
            const personaKey = calculatePersona(answers);
            const content = PERSONA_DB[personaKey];
            const [step, setStep] = useState('INPUT'); 
            const [userTask, setUserTask] = useState("");
            const [committed, setCommitted] = useState(false);

            const handleGenerate = () => {
                if(!userTask.trim()) return;
                setStep('CARD');
            };

            const handleCommit = (e) => {
                e.stopPropagation();
                setCommitted(true);
                // å…³é”®ç‚¹ï¼šæŒ‰ä¸‹æ‰‹å°åï¼Œè·³è½¬åˆ° BRIDGE (ä¸“å®¶è¿æ¥é¡µ)
                setTimeout(() => onCommit(userTask, true), 1200); 
            };

            if (step === 'INPUT') {
                return (
                    <div className="min-h-screen bg-black flex flex-col justify-center items-center px-6 fade-in">
                        <div className="max-w-2xl w-full">
                            <div className="text-[var(--accent)] font-mono text-xs mb-4 tracking-widest uppercase">Self-Contract Protocol</div>
                            <h2 className="text-3xl md:text-4xl font-bold text-white mb-6">çœŸæ­£çš„æ”¹å˜ï¼Œ<br/>æ¥è‡ªä½ çš„<span className="text-[var(--gold)]">è‡ªæˆ‘æ‰¿è¯º</span>ã€‚</h2>
                            <div className="bg-zinc-900/50 border border-zinc-800 p-6 rounded-xl mb-8">
                                <p className="text-zinc-400 text-sm mb-4">ç³»ç»Ÿå»ºè®®æ–¹å‘ï¼š<span className="text-white font-bold">{content.priority}</span></p>
                                <p className="text-zinc-300 text-lg serif italic">"åŸºäºè¯Šæ–­ï¼Œä¸ºäº†{content.priority}ï¼Œæœªæ¥ 2 å‘¨å†…ï¼Œæˆ‘å¯ä»¥ç«‹å³æ‰§è¡Œçš„ä¸€ä»¶â€˜æœ€å°çš„å°äº‹â€™æ˜¯..."</p>
                            </div>
                            <textarea className="w-full bg-black border border-zinc-700 rounded-xl p-6 text-white text-xl font-serif cyber-input mb-8 focus:border-[var(--gold)]" rows="3" placeholder="ä¾‹å¦‚ï¼šæ¯å¤©æ—©èµ·1å°æ—¶ / æŒ‚é—²é±¼å–ä¸€ä»¶ä¸œè¥¿..." value={userTask} onChange={(e) => setUserTask(e.target.value)}></textarea>
                            <button onClick={handleGenerate} disabled={!userTask.trim()} className="w-full py-4 bg-white text-black font-bold text-lg rounded-full hover:bg-[var(--gold)] transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-[0_0_20px_rgba(255,255,255,0.2)]">ç”Ÿæˆè¡ŒåŠ¨å¥‘çº¦</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-black flex flex-col justify-center items-center px-6 fade-in bg-grid py-12 relative">
                    <div className="w-full max-w-md perspective-1000 group mb-8">
                        <div className="relative w-full bg-[#0f0f0f] border border-[var(--gold)] rounded-2xl p-8 shadow-[0_0_50px_rgba(255,215,0,0.15)] glow-pulse">
                            <div className="text-center mb-8">
                                <div className="text-[var(--gold)] font-mono text-xs border border-[var(--gold)] px-3 py-1 rounded inline-block mb-4 tracking-widest bg-[var(--gold)]/10">MY PACT</div>
                                <h3 className="text-2xl font-bold text-white mb-2 serif">è¡ŒåŠ¨å¥‘çº¦ä¹¦</h3>
                                <div className="w-full h-px bg-gradient-to-r from-transparent via-[var(--gold)] to-transparent opacity-50 my-4"></div>
                            </div>
                            <p className="text-zinc-400 text-sm font-mono mb-2 text-center">I COMMIT TO:</p>
                            <h2 className="text-3xl font-black text-white text-center mb-8 leading-tight italic">"{userTask}"</h2>
                            <div className="mt-8 text-center">
                                {!committed ? (
                                    <button onClick={handleCommit} className="w-full py-4 bg-[var(--gold)] text-black font-bold hover:bg-white transition-all rounded-lg uppercase tracking-widest text-sm shadow-lg group relative overflow-hidden">
                                        <span className="relative z-10 flex items-center justify-center gap-2"><i data-lucide="fingerprint" width="20"></i> æŒ‰ä¸‹æ‰‹å°ç”Ÿæ•ˆ</span>
                                    </button>
                                ) : (
                                    <div className="animate-pulse flex flex-col items-center py-2"><div className="text-green-500 font-bold text-lg mb-1 flex items-center gap-2"><i data-lucide="check-circle" width="20"></i> å¥‘çº¦å·²ç”Ÿæ•ˆ</div><div className="text-xs text-zinc-500">æ­£åœ¨å‰å¾€ä¸“å®¶é€šé“...</div></div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- THE CONNECTION (EXPERT PAGE) ---
        const ExpertPage = ({ onDashboard, onBack }) => { // Added onBack prop support for overlay mode
            const [showQR, setShowQR] = useState(false);
            return (
                <div className="min-h-screen bg-black flex flex-col items-center justify-center p-6 slide-up bg-grid">
                    <div className="max-w-lg w-full text-center mt-8 p-8 border border-[var(--gold)]/20 rounded-2xl bg-[#0f0f0f] shadow-[0_0_50px_rgba(255,215,0,0.1)]">
                        {onBack && (
                            <button onClick={onBack} className="absolute top-8 left-8 text-zinc-400 hover:text-[var(--accent)] flex items-center gap-3 text-xl font-bold transition-all hover:-translate-x-1 group">
                                <i data-lucide="arrow-left" width="28" height="28" className="group-hover:text-[var(--accent)]"></i> è¿”å›ä»ªè¡¨ç›˜
                            </button>
                        )}
                        
                        <div className="w-24 h-24 rounded-full bg-zinc-800 border-2 border-[var(--gold)] flex items-center justify-center mx-auto mb-8 relative shadow-[0_0_40px_rgba(255,215,0,0.2)]">
                            <svg className="w-12 h-12 text-[var(--gold)]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        </div>
                        <h2 className="text-3xl font-bold text-white mb-4 leading-tight">æ‹¿ä¸å®šä¸»æ„ï¼Ÿ<br/>è¿˜æ˜¯é‡è§äº†å¡ç‚¹ï¼Ÿ</h2>
                        <p className="text-zinc-400 text-sm mb-10 leading-relaxed px-4">
                            æ”¹å˜å¾ˆéš¾ï¼Œä¸è¦ç‹¬è‡ªç¡¬æŠ—ã€‚<br/>
                            æˆ‘æ˜¯ <strong>å°éº¦</strong>ï¼Œä¼ä¸šç®¡ç†å’¨è¯¢ä¸“å®¶ & æˆ˜ç•¥ä¸“å®¶ã€‚<br/>
                            åœ¨æ‰§è¡Œä¸­é‡åˆ°ä»»ä½•é˜»åŠ›ï¼Œæ‰¾æˆ‘èŠèŠã€‚
                        </p>
                        
                        <div className="space-y-4">
                            {showQR ? (
                                <div className="bg-white p-6 rounded-2xl mx-auto w-64 h-auto flex flex-col items-center justify-center shadow-2xl relative animate-pulse border-4 border-[var(--gold)]">
                                    <button onClick={() => setShowQR(false)} className="absolute top-2 right-2 text-black hover:text-red-500"><i data-lucide="x"></i></button>
                                    
                                    {/* --- è¯·åœ¨è¿™é‡Œæ›¿æ¢æ‚¨çš„äºŒç»´ç å›¾ç‰‡ --- */}
                                    {/* 1. å°†æ‚¨çš„äºŒç»´ç å›¾ç‰‡æ”¾åœ¨åŒçº§ç›®å½•ä¸‹ï¼Œå‘½åä¸º qrcode.jpg */}
                                    {/* 2. æˆ–è€…ç›´æ¥ä¿®æ”¹ä¸‹æ–¹çš„ src="qrcode.jpg" ä¸ºæ‚¨çš„å›¾ç‰‡é“¾æ¥ */}
                                    
                                    <img 
                                        src="qrcode.jpg" 
                                        alt="åŠ æˆ‘å¾®ä¿¡" 
                                        className="w-64 h-64 object-contain mb-2"
                                        onError={(e) => {
                                            // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå›é€€æ˜¾ç¤ºå›¾æ ‡ï¼Œé˜²æ­¢ç©ºç™½
                                            e.target.style.display='none';
                                            e.target.nextSibling.style.display='block';
                                        }}
                                    />
                                    
                                    {/* å¤‡ç”¨å›¾æ ‡ (å›¾ç‰‡ä¸å­˜åœ¨æ—¶æ˜¾ç¤º) */}
                                    <i data-lucide="qr-code" width="80" height="80" className="text-black mb-4" style={{display:'none'}}></i>
                                    
                                    <span className="text-xs text-zinc-500 font-mono font-bold">æ‰«ç æ·»åŠ å°éº¦å¾®ä¿¡</span>
                                </div>
                            ) : (
                                <button onClick={() => setShowQR(true)} className="w-full md:w-auto px-10 py-4 bg-[var(--gold)] text-black font-bold text-lg rounded-full hover:bg-yellow-400 transition-all shadow-[0_0_20px_rgba(255,215,0,0.3)] flex items-center justify-center gap-2 mx-auto"><span>æ·»åŠ å°éº¦ (è·å–æ”¯æŒ)</span><i data-lucide="arrow-right" width="20"></i></button>
                            )}
                            
                            <div className="flex justify-center gap-4 mt-8 pt-8 border-t border-zinc-900">
                                <button onClick={() => window.open('https://www.youtube.com/@xiao-mai-128', '_blank')} className="py-2 px-6 bg-zinc-900 border border-zinc-800 rounded-full text-zinc-400 text-sm hover:text-white flex items-center gap-2"><i data-lucide="youtube" width="14"></i> Youtube</button>
                                <button onClick={() => window.open('https://www.douyin.com/', '_blank')} className="py-2 px-6 bg-zinc-900 border border-zinc-800 rounded-full text-zinc-400 text-sm hover:text-white flex items-center gap-2">æŠ–éŸ³ä¸»é¡µ</button>
                            </div>
                            
                            <div className="mt-8">
                                <button onClick={onDashboard} className="text-zinc-500 text-sm underline hover:text-white transition-colors">æˆ‘å·²ç»å‡†å¤‡å¥½äº†ï¼Œè¿›å…¥æˆ˜ç•¥æŒ‡æŒ¥å®¤ â†’</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- DASHBOARD VIEW (V13.0 FINAL: SUMMARY + TRACKER) ---
        const DashboardView = ({ answers, task, onShowExpert, onExit }) => {
            const scores = calculateScores(answers);
            const status = getFuzzyStatus(scores);
            const personaKey = calculatePersona(answers);
            const content = PERSONA_DB[personaKey];
            const dateID = new Date().toISOString().slice(0,10).replace(/-/g,'');
            
            // Check-in Logic (Persistence)
            const [checkins, setCheckins] = useState(() => {
                const saved = localStorage.getItem('LIFEOS_CHECKINS');
                return saved ? JSON.parse(saved) : Array(14).fill(false);
            });
            const toggleCheckin = (idx) => {
                const newCheckins = [...checkins];
                newCheckins[idx] = !newCheckins[idx];
                setCheckins(newCheckins);
                localStorage.setItem('LIFEOS_CHECKINS', JSON.stringify(newCheckins));
            };
            const progress = Math.round((checkins.filter(Boolean).length / 14) * 100);

            // Radar Chart
            const chartRef = useRef(null);
            useEffect(() => {
                if(chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['è´¢åŠ¡', 'æ—¶é—´', 'æŠ¤åŸæ²³', 'ç²¾åŠ›', 'æˆ˜ç•¥'],
                            datasets: [{ label: 'çŠ¶æ€', data: [scores.financial, scores.time, scores.risk, scores.energy, 60], backgroundColor: 'rgba(0, 240, 255, 0.1)', borderColor: '#00f0ff', borderWidth: 2, pointBackgroundColor: '#000', pointBorderColor: '#00f0ff' }]
                        },
                        options: { scales: { r: { angleLines: {color:'rgba(255,255,255,0.05)'}, grid: {color:'rgba(255,255,255,0.05)'}, pointLabels: {color:'#888', font:{size:10}}, ticks: {display:false} } }, plugins: {legend:{display:false}} }
                    });
                    return () => chart.destroy();
                }
            }, [scores]);

            return (
                <div className="min-h-screen bg-black text-white p-4 md:p-8 fade-in pb-20 font-sans">
                    <div className="flex justify-between items-end mb-8 border-b border-zinc-800 pb-4">
                        <div><div className="text-[10px] font-mono text-[var(--accent)] mb-1 tracking-widest border border-[var(--accent)]/30 inline-block px-2 py-0.5 rounded bg-[var(--accent)]/5">CEO DASHBOARD</div><h1 className="text-3xl md:text-4xl font-bold tracking-tight text-white">æˆ˜ç•¥æŒ‡æŒ¥å®¤</h1></div>
                        <div className="text-right hidden md:block"><div className="text-xs text-zinc-500 font-mono mb-1">{dateID}</div><div className="text-[10px] text-green-500 font-mono flex items-center justify-end gap-1"><span className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> ONLINE</div></div>
                    </div>

                    <div className="grid grid-cols-12 gap-6 mb-12">
                        {/* 1. Summary Card */}
                        <div className="col-span-12 md:col-span-4 dash-card border-t-4 border-t-[var(--accent)]">
                            <div className="flex justify-between items-start mb-4">
                                <div><div className="text-zinc-500 text-xs font-mono uppercase mb-1">PLAYER PROFILE</div><h2 className="text-2xl font-bold text-white mb-1">{content.label}</h2></div>
                                <div className="text-right"><div className="text-[var(--accent)] font-bold">{status.sysVersion}</div><div className="text-xs text-zinc-600">{status.defenseLevel}</div></div>
                            </div>
                            <div className="h-40 flex items-center justify-center"><canvas ref={chartRef}></canvas></div>
                        </div>

                        {/* 2. Habit Tracker */}
                        <div className="col-span-12 md:col-span-8 dash-card border-t-4 border-t-[var(--matrix-green)] flex flex-col">
                            <div className="flex justify-between items-start mb-6">
                                <div><div className="text-[var(--matrix-green)] font-mono text-xs mb-1">CURRENT MISSION</div><h3 className="text-xl font-bold text-white mb-1">"{task}"</h3><p className="text-zinc-500 text-xs">è¿ç»­æ‰§è¡Œ 14 å¤©ï¼Œé‡å¡‘ç³»ç»Ÿæƒ¯æ€§ã€‚</p></div>
                                <div className="text-right"><div className="text-3xl font-bold text-white mono">{progress}%</div><div className="text-[10px] text-zinc-500">COMPLETED</div></div>
                            </div>
                            <div className="grid grid-cols-7 gap-2 md:gap-3 mb-4 flex-1">
                                {checkins.map((checked, i) => (
                                    <div key={i} onClick={() => toggleCheckin(i)} className={`check-capsule ${checked ? 'checked' : ''}`}>
                                        <span className="day-label">D{i+1}</span>
                                        <i data-lucide="check" width="16" className="icon-box"></i>
                                    </div>
                                ))}
                            </div>
                            {/* Permanent Help Button */}
                            <div onClick={onShowExpert} className="mt-4 pt-4 border-t border-zinc-800 flex items-center justify-between cursor-pointer group">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 rounded-full bg-[var(--gold)]/20 flex items-center justify-center text-[var(--gold)]"><i data-lucide="help-circle" width="16"></i></div>
                                    <div><div className="text-zinc-300 text-sm font-bold group-hover:text-[var(--gold)] transition-colors">æ‰§è¡Œé‡åˆ°å›°éš¾ï¼Ÿ</div><div className="text-zinc-600 text-xs">å‘¼å«å°éº¦ (æˆ˜ç•¥æ”¯æŒ)</div></div>
                                </div>
                                <i data-lucide="chevron-right" className="text-zinc-600 group-hover:text-white transition-colors"></i>
                            </div>
                        </div>
                    </div>

                    <div className="mt-12 text-center border-t border-zinc-900 pt-6">
                        <button onClick={onExit} className="text-xs text-zinc-600 hover:text-white transition-colors flex items-center justify-center gap-2 mx-auto"><i data-lucide="rotate-ccw" width="12"></i> è¿”å›ç³»ç»Ÿé¦–é¡µ (Restart)</button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 3. MAIN APP CONTROLLER
        // ==========================================

        const App = () => {
            const [view, setView] = useState('INTRO');
            const [qIndex, setQIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [finalTask, setFinalTask] = useState("");

            // Persistence
            useEffect(() => {
                const savedState = localStorage.getItem('LIFEOS_STATE');
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    if(parsed.view === 'DASHBOARD') {
                        setAnswers(parsed.answers);
                        setFinalTask(parsed.finalTask);
                        setView('DASHBOARD');
                    }
                }
            }, []);

            useEffect(() => {
                if (view === 'DASHBOARD') {
                    localStorage.setItem('LIFEOS_STATE', JSON.stringify({ view, answers, finalTask }));
                }
            }, [view, answers, finalTask]);

            const handleAnswer = (opt) => {
                const currentQ = QUESTIONS[qIndex];
                setAnswers(prev => ({ ...prev, [currentQ.id]: opt }));
                if (qIndex < QUESTIONS.length - 1) setQIndex(prev => prev + 1);
                else setView('PROCESSING');
            };

            const handleBack = () => { if(qIndex > 0) setQIndex(prev => prev - 1); else setView('INTRO'); };
            const handleRetry = () => { setQIndex(0); setView('AUDIT'); };
            
            // Flow: MVP -> Expert (Bridge) -> Dashboard
            const handleCommit = (task, goToBridge = false) => { 
                setFinalTask(task); 
                if(goToBridge) setView('BRIDGE');
                else setView('DASHBOARD');
            };
            
            const handleRestart = () => {
                setQIndex(0); setAnswers({}); setFinalTask(""); setView('INTRO');
                localStorage.removeItem('LIFEOS_STATE');
                // Keep habits (checkins) optionally
            };

            return (
                <div className="antialiased selection:bg-[var(--accent)] selection:text-black">
                    {view === 'INTRO' && <IntroView onStart={() => setView('AUDIT')} />}
                    {view === 'AUDIT' && <AuditView qIndex={qIndex} onAnswer={handleAnswer} onBack={handleBack} />}
                    {view === 'PROCESSING' && <ProcessingView onComplete={() => setView('REPORT')} />}
                    {view === 'REPORT' && <ReportView answers={answers} onNext={() => setView('MVP')} onRetry={handleRetry} />}
                    {view === 'MVP' && <MVPView answers={answers} onCommit={handleCommit} />}
                    {view === 'BRIDGE' && <ExpertPage onDashboard={() => setView('DASHBOARD')} />}
                    {view === 'DASHBOARD' && <DashboardView answers={answers} task={finalTask} onShowExpert={() => setView('EXPERT_OVERLAY')} onExit={handleRestart} />}
                    {view === 'EXPERT_OVERLAY' && <ExpertPage onBack={() => setView('DASHBOARD')} onDashboard={() => setView('DASHBOARD')} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


